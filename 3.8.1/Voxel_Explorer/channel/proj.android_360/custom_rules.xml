<?xml version="1.0" encoding="UTF-8"?>
<project name="" default="release">


    <!-- Converts this project's .class files into .dex files -->
    <target name="-dex" depends="-compile, -post-compile, -obfuscate">
        <do-only-if-manifest-hasCode elseText="hasCode = false. Skipping...">
            <!-- only convert to dalvik bytecode is *not* a library -->
            <do-only-if-not-library elseText="Library project: do not convert bytecode..." >
                <!-- special case for instrumented builds: need to use no-locals and need
                     to pass in the emma jar. -->
                <if condition="${build.is.instrumented}">
                    <then>
                        <dex-helper nolocals="true">
                            <external-libs>
                                <fileset file="${emma.dir}/emma_device.jar" />
                            </external-libs>
                        </dex-helper>
                    </then>
                    <else>
                        <dex-helper>
                        </dex-helper>
                    </else>
                </if>
            </do-only-if-not-library>
        </do-only-if-manifest-hasCode>

		<exec executable="python" failonerror="true">
            <arg value="build_native.py"/>
            <arg value="-b"/>
            <arg value="release"/>
        </exec>
    </target>

   <tstamp>
    <format property="current.date" pattern="yyyyMMddHHmm"/>
  </tstamp>

    <target name="export-signed-apk" depends="release">
        <!-- delete temp files -->
        <delete>
            <fileset dir="${out.absolute.dir}" includes="build.prop resources.ap_ ${dex.file.name}* ${resource.package.file.name}* ${ant.project.name}-release-unaligned.apk ${ant.project.name}-release-unsigned.apk*"/>
        </delete>

        <property name="apk.dir" value="../../bin/release/" />
        <property name="apk.targetDevice" value="" />
        <property name="apk.channel.id" value="" />
        <property name="apk.channel.name" value="" />
        <property name="apk.comment" value="" />
        <property name="apk.lang" value="" />
        <xpath input="AndroidManifest.xml" expression="/manifest/@android:versionCode" output="apk.version.code" default="0"/>
        <xpath input="AndroidManifest.xml" expression="/manifest/@android:versionName" output="apk.version.name"/>

        <!-- rename final apk file -->
        <move file="${out.final.file}" tofile="${apk.dir}/${ant.project.name}_${apk.channel.id}${apk.targetDevice}${apk.channel.name}_${apk.version.name}_${apk.version.code}${apk.comment}${apk.lang}_${current.date}.apk" />
    </target>

</project>